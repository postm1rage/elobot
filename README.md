# Документация и инструкция по установке ELO Bot

## Описание проекта

ELO Bot - это Discord бот для организации рейтинговых матчей с системой ELO. Основные функции:

- Верификация игроков
- Система очередей для поиска матчей
- Автоматическое создание матчей
- Подтверждение результатов
- Турнирная система
- Лидерборды и статистика игроков
- Модерация (баны, черные списки)

## Технические требования

- Python 3.8+
- Discord сервер с правами на создание каналов и ролей
- Доступ к базе данных SQLite

## Установка

### 1. Клонирование репозитория

```bash
git clone https://github.com/ваш-репозиторий/elo-bot.git
cd elo-bot
```

### 2. Установка зависимостей

```bash
pip install -r requirements.txt
```

Основные зависимости:
- discord.py
- python-dotenv
- sqlite3

### 3. Настройка конфигурации

1. Создайте файл `.env` в корне проекта:
```
DISCORD_TOKEN=ваш_токен_бота
```

2. Настройте `config.py` под ваши нужды:
```python
# Основные настройки
MODERATOR_ID = 123456789012345678  # ID модератора
VERIFIED_ROLE_NAME = "verified"     # Название роли для верифицированных пользователей

# Названия каналов
VERIFY_CHANNEL_NAME = "elobot-verify"
VERIFICATION_LOGS_CHANNEL_NAME = "elobot-logs"
QUEUE_CHANNEL_NAME = "elobot-queue"
MATCH_RESULTS_CHANNEL_NAME = "elobot-results"
```

### 4. Инициализация базы данных

Бот автоматически создаст необходимые таблицы при первом запуске. Файлы баз данных:
- `elobotplayers.db` - игроки и статистика
- `elobotmatches.db` - информация о матчах
- `elotournaments.db` - турниры

### 5. Запуск бота

```bash
python main.py
```

## Настройка Discord сервера

### Необходимые каналы

1. Создайте следующие текстовые каналы:
   - `elobot-verify` - для верификации новых игроков
   - `elobot-logs` - логи действий бота
   - `elobot-queue` - очередь на матчи
   - `elobot-results` - результаты матчей

2. Для каждого турнира будут автоматически создаваться каналы:
   - `[название-турнира]✨﹒info` - информация
   - `[название-турнира]✨﹒results` - результаты
   - `[название-турнира]✨﹒matches` - матчи
   - `[название-турнира]✨﹒register` - регистрация

### Необходимые права

Боту требуются следующие права:
- Чтение/отправка сообщений
- Управление ролями
- Управление никнеймами
- Управление каналами (для турниров)

## Руководство администратора

### Основные команды

- `.tournament <название> <слоты>` - создать турнир
- `.tstart` - начать зарегистрированный турнир
- `.nexttour` - начать следующий тур в турнире
- `.setwinner <ID матча> <ник победителя>` - вручную установить победителя
- `.ban <ник>` - забанить игрока
- `.unban <ник>` - разбанить игрока
- `.blacklist @игрок` - добавить в черный список
- `.unblacklist @игрок` - убрать из черного списка

### Верификация новых игроков

1. Игрок отправляет в `elobot-verify`:
   - Свой игровой ник
   - Скриншот профиля (прикрепленный файл)

2. Модератор получает уведомление и подтверждает верификацию

3. Бот:
   - Добавляет игрока в базу
   - Выдает роль "verified"
   - Обновляет никнейм на сервере в формате "Ник [ELO]"

## Руководство пользователя

### Основные команды

- `.play` - войти в очередь
- `.leave` - выйти из очереди
- `.giveup` - сдаться в текущем матче
- `.queue` - показать состояние очередей
- `.playerinfo <ник>` - информация об игроке
- `.leaderboard` - таблица лидеров
- `.report <ID матча> <причина>` - пожаловаться на матч

### Процесс игры

1. Используйте `.play` в канале `elobot-queue`
2. Выберите режим игры
3. Когда матч найден, получите уведомление в ЛС
4. После матча победитель отправляет результат:
   ```
   .result <ID матча> <счет>
   ```
   Например: `.result 123 5-3`

### Турниры

1. Зарегистрируйтесь в канале регистрации турнира
2. Когда турнир начнется, получайте уведомления о матчах
3. Турнирные матчи работают так же, как обычные

## Логирование

Бот ведет логи в нескольких местах:
- Консоль (основные события)
- Файл `discord.log` (логи Discord API)
- Файл `bot_errors.log` (критические ошибки)
- Канал `elobot-logs` (действия модераторов)

## Обновление

Для обновления бота:
```bash
git pull origin main
pip install -r requirements.txt
```

## Устранение неисправностей

1. **Бот не запускается**:
   - Проверьте токен в `.env`
   - Убедитесь, что Python 3.8+ установлен
   - Проверьте права на запись в директорию бота

2. **Не создаются каналы/роли**:
   - Проверьте права бота на сервере
   - Убедитесь, что бот имеет права администратора или нужные конкретные права

3. **Проблемы с базой данных**:
   - Удалите файлы `*.db` (бот создаст новые)
   - Проверьте права на запись

Для дополнительной помощи обращайтесь к разработчику.
